<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What To Prompt? - AI Prompt Engineering</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .message-bubble {
      animation: slideUp 0.3s ease-out;
      max-width: 100%;
      word-wrap: break-word;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-bubble {
      background: #000;
      color: white;
      padding: 0.875rem 1rem;
      border-radius: 1rem 1rem 0.25rem 1rem;
      margin-left: auto;
      max-width: 80%;
    }

    .assistant-bubble {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 0.875rem 1rem;
      border-radius: 1rem 1rem 1rem 0.25rem;
      margin-right: auto;
      max-width: 80%;
    }

    .typing-indicator {
      display: flex;
      gap: 0.25rem;
      padding: 1rem;
    }

    .typing-indicator .dot {
      width: 8px;
      height: 8px;
      background: #6b7280;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .typing-indicator .dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .typing-indicator .dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes bounce {
      0%, 80%, 100% {
        transform: scale(0);
      }
      40% {
        transform: scale(1);
      }
    }

    .gradient-btn {
      background: linear-gradient(135deg, #3b3b3b 0%, #1a1a1a 100%);
      transition: all 0.2s ease;
    }

    .gradient-btn:hover {
      background: linear-gradient(135deg, #4b4b4b 0%, #2a2a2a 100%);
    }

    .gradient-btn:active {
      transform: scale(0.98);
    }

    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }

    .sidebar {
      width: 320px;
      min-width: 320px;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        min-width: 100%;
      }
    }
  </style>
</head>
<body class="bg-white h-screen flex flex-col overflow-hidden">

  <!-- Privacy Modal -->
  <div id="privacy-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full mx-4">
      <h2 class="text-2xl font-semibold mb-3">Privacy Notice</h2>
      <p class="text-gray-600 mb-6">⚠️ Please do not share personal, financial, or password information. This tool is for safe prompt generation only.</p>
      <div class="flex items-center mb-6">
        <input type="checkbox" id="dismiss-forever" class="w-4 h-4 rounded focus:ring-gray-500" />
        <label for="dismiss-forever" class="ml-2 text-sm text-gray-600">Don't show this again</label>
      </div>
      <button id="close-modal-btn" class="w-full gradient-btn text-white px-6 py-3 rounded-lg font-medium">
        Understood
      </button>
    </div>
  </div>

  <!-- Header -->
  <header class="border-b border-gray-200 bg-white">
    <div class="px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-white font-bold text-2xl">
          ?
        </div>
        <div>
          <h1 class="text-xl font-semibold">What To Prompt?</h1>
          <p class="text-xs text-gray-500">AI-Powered Prompt Engineering</p>
        </div>
      </div>
      <button id="help-btn" class="text-gray-600 hover:text-black text-sm font-medium">
        Help
      </button>
    </div>
  </header>

  <!-- Help Drawer -->
  <div id="help-drawer" class="hidden fixed right-4 top-20 bg-white rounded-lg shadow-xl border border-gray-200 p-6 w-80 z-50">
    <h3 class="font-semibold text-lg mb-3">How to Use</h3>
    <div class="space-y-2 text-sm text-gray-600">
      <p>• <strong>Visual Builder:</strong> Structured fields for detailed prompts</p>
      <p>• <strong>Guided Chat:</strong> Natural conversation to refine ideas</p>
      <p>• <strong>Switch Models:</strong> Try different AI models</p>
      <p>• <strong>Clear Chat:</strong> Start fresh anytime</p>
    </div>
    <button onclick="document.getElementById('help-drawer').classList.add('hidden')" 
      class="mt-4 w-full text-sm text-gray-600 hover:text-black font-medium">
      Close
    </button>
  </div>

  <!-- Main Layout -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Left Sidebar -->
    <div class="sidebar border-r border-gray-200 bg-gray-50 flex flex-col overflow-hidden">
      <div class="p-4 flex-shrink-0">
        <!-- Mode Switcher -->
        <div class="mb-6">
          <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">Mode</label>
          <div class="flex rounded-lg bg-white border border-gray-200 overflow-hidden">
            <button type="button" id="visual-mode-btn" 
              class="flex-1 px-4 py-2.5 text-sm font-medium border-r border-gray-200 hover:bg-gray-50 transition">
              Visual
            </button>
            <button type="button" id="guided-mode-btn" 
              class="flex-1 px-4 py-2.5 text-sm font-medium bg-black text-white hover:bg-gray-800 transition">
              Guided
            </button>
          </div>
        </div>

        <!-- Visual Form -->
        <form id="visual-form" class="space-y-4 hidden">
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">Role</label>
            <textarea id="role-input" rows="2" placeholder="e.g., Senior Developer"
              class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition resize-none"></textarea>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">Task *</label>
            <textarea id="task-input" rows="2" placeholder="e.g., Write a function"
              class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition resize-none"></textarea>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">Context</label>
            <textarea id="context-input" rows="2" placeholder="e.g., For web app"
              class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition resize-none"></textarea>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">Constraints</label>
            <textarea id="constraints-input" rows="2" placeholder="e.g., Use TypeScript"
              class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition resize-none"></textarea>
          </div>
          <button type="submit" class="w-full gradient-btn text-white px-4 py-3 rounded-md font-medium text-sm">
            Generate Prompt
          </button>
        </form>

        <!-- Guided Form -->
        <div id="guided-form-container">
          <form id="guided-form" class="relative">
            <input id="guided-input" type="text" 
              class="w-full px-4 py-3 pr-12 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition" 
              placeholder="Type your idea..." />
            <button type="submit" 
              class="absolute right-2 top-1/2 -translate-y-1/2 bg-black text-white rounded p-2 hover:bg-gray-800 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </form>
        </div>

        <!-- Loading -->
        <div id="loading-spinner" class="hidden mt-3 flex justify-center">
          <div class="flex items-center gap-2 text-gray-600">
            <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
            <span class="text-xs font-medium">Generating...</span>
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="mt-auto p-4 border-t border-gray-200 bg-white space-y-3">
        <div>
          <label class="block text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wider">AI Model</label>
          <select id="model-selector" class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 focus:border-black focus:ring-1 focus:ring-black transition bg-white">
            <option value="google/gemini-flash-1.5">Google - Gemini Flash 1.5</option>
            <option value="anthropic/claude-3-haiku-20240307">Anthropic - Claude 3 Haiku</option>
            <option value="nousresearch/nous-hermes-2-mixtral-8x7b-dpo">Nous - Hermes 2 Mixtral</option>
            <option value="mistralai/mistral-large-latest">Mistral - Large</option>
            <option value="openai/gpt-4o">OpenAI - GPT-4o</option>
          </select>
        </div>
        <button type="button" id="clear-chat-btn" class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 hover:bg-gray-50 hover:border-red-400 hover:text-red-600 transition font-medium">
          Clear Chat
        </button>
      </div>
    </div>

    <!-- Right Chat Area -->
    <div class="flex-1 flex flex-col overflow-hidden bg-white">
      <div id="chat-container" class="flex-1 overflow-y-auto px-8 py-6">
        <div class="max-w-4xl mx-auto">
          <div id="chat-inner" class="flex flex-col gap-3">
            <div id="placeholder" class="flex flex-col items-center justify-center min-h-[400px] text-center">
              <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-white font-bold text-5xl mb-4">
                ?
              </div>
              <h2 class="text-2xl font-semibold text-gray-900 mb-2">Ready to Create Prompts</h2>
              <p class="text-gray-500 text-sm">Choose a mode and start crafting your AI prompt</p>
            </div>
            <div id="chat-anchor"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://prompt-alchemist.onrender.com/api/v1/chat';
    let conversationHistory = [];
    let currentMode = 'guided';

    const chatInner = document.getElementById('chat-inner');
    const visualForm = document.getElementById('visual-form');
    const guidedForm = document.getElementById('guided-form');
    const roleInput = document.getElementById('role-input');
    const taskInput = document.getElementById('task-input');
    const contextInput = document.getElementById('context-input');
    const constraintsInput = document.getElementById('constraints-input');
    const guidedInput = document.getElementById('guided-input');
    const visualModeBtn = document.getElementById('visual-mode-btn');
    const guidedModeBtn = document.getElementById('guided-mode-btn');
    const modelSelector = document.getElementById('model-selector');
    const clearChatBtn = document.getElementById('clear-chat-btn');
    const spinner = document.getElementById('loading-spinner');
    const helpBtn = document.getElementById('help-btn');
    const helpDrawer = document.getElementById('help-drawer');

    // Privacy Modal
    window.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('privacy-modal');
      const closeBtn = document.getElementById('close-modal-btn');
      const dismissCheckbox = document.getElementById('dismiss-forever');

      if (!localStorage.getItem('privacyDismissed')) {
        modal.classList.remove('hidden');
      }

      closeBtn.addEventListener('click', () => {
        if (dismissCheckbox.checked) {
          localStorage.setItem('privacyDismissed', 'true');
        }
        modal.classList.add('hidden');
      });

      helpBtn.addEventListener('click', () => {
        helpDrawer.classList.toggle('hidden');
      });

      loadHistory();
      setMode(localStorage.getItem('lastMode') || 'guided');
    });

    function autoScroll() {
      const anchor = document.getElementById('chat-anchor');
      if (anchor) {
        setTimeout(() => {
          anchor.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }, 100);
      }
    }

    function removePlaceholder() {
      const placeholder = document.getElementById('placeholder');
      if (placeholder) {
        placeholder.remove();
      }
    }

    function setMode(mode) {
      currentMode = mode;
      localStorage.setItem('lastMode', mode);

      if (mode === 'visual') {
        visualForm.classList.remove('hidden');
        guidedForm.parentElement.classList.add('hidden');
        visualModeBtn.classList.add('bg-black', 'text-white');
        visualModeBtn.classList.remove('hover:bg-gray-50');
        guidedModeBtn.classList.remove('bg-black', 'text-white');
        guidedModeBtn.classList.add('hover:bg-gray-50');
      } else {
        visualForm.classList.add('hidden');
        guidedForm.parentElement.classList.remove('hidden');
        guidedModeBtn.classList.add('bg-black', 'text-white');
        guidedModeBtn.classList.remove('hover:bg-gray-50');
        visualModeBtn.classList.remove('bg-black', 'text-white');
        visualModeBtn.classList.add('hover:bg-gray-50');
      }
    }

    visualModeBtn.addEventListener('click', () => setMode('visual'));
    guidedModeBtn.addEventListener('click', () => setMode('guided'));

    visualForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userIdea = `Role: ${roleInput.value.trim()}\nTask: ${taskInput.value.trim()}\nContext: ${contextInput.value.trim()}\nConstraints: ${constraintsInput.value.trim()}`.trim();

      if (!taskInput.value.trim()) {
        alert('Please describe the main task.');
        return;
      }

      roleInput.value = '';
      taskInput.value = '';
      contextInput.value = '';
      constraintsInput.value = '';

      await processMessage(userIdea);
    });

    guidedForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userMessage = guidedInput.value.trim();
      if (!userMessage) return;
      guidedInput.value = '';
      await processMessage(userMessage);
    });

    async function processMessage(userContent) {
      removePlaceholder();
      displayUserMessage(userContent);
      saveHistory('user', userContent);

      const typingBubble = document.createElement('div');
      typingBubble.className = 'flex justify-start';
      typingBubble.innerHTML = '<div class="message-bubble assistant-bubble typing-indicator"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
      const anchor = document.getElementById('chat-anchor');
      anchor.before(typingBubble);
      autoScroll();

      spinner.classList.remove('hidden');

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            messages: conversationHistory,
            target_model: modelSelector.value,
            mode: currentMode
          })
        });

        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        
        typingBubble.remove();
        displayAssistantMessage(data.expert_prompt, data.explanation);
        saveHistory('assistant', data);
      } catch (error) {
        console.error('Error:', error);
        typingBubble.remove();
        displayAssistantMessage('Sorry, something went wrong. Please try again.');
      } finally {
        spinner.classList.add('hidden');
      }
    }

    function displayUserMessage(content) {
      const msg = document.createElement('div');
      msg.className = 'flex justify-end';
      msg.innerHTML = `
        <div class="message-bubble user-bubble">
          <pre class="text-sm">${escapeHtml(content)}</pre>
          <div class="mt-2 flex gap-3 text-xs text-gray-400">
            <button onclick="copyText(this, \`${escapeHtml(content).replace(/`/g, '\\`')}\`)" class="hover:text-white">Copy</button>
          </div>
        </div>
      `;
      const anchor = document.getElementById('chat-anchor');
      anchor.before(msg);
      autoScroll();
    }

    function displayAssistantMessage(content, explanation) {
      const msg = document.createElement('div');
      msg.className = 'flex justify-start';
      
      let html = `
        <div class="message-bubble assistant-bubble">
          <div class="text-xs font-semibold text-gray-500 mb-2">AI SUGGESTION</div>
          <pre class="text-sm text-gray-900">${escapeHtml(content)}</pre>
      `;

      if (explanation) {
        html += `
          <button onclick="toggleExplanation(this)" class="mt-2 text-xs text-gray-600 hover:text-black font-medium">
            View Explanation
          </button>
          <div class="hidden mt-2 p-3 bg-gray-100 rounded text-xs text-gray-700">
            ${escapeHtml(explanation)}
          </div>
        `;
      }

      html += `
          <div class="mt-2 flex gap-3 text-xs text-gray-500">
            <button onclick="copyText(this, \`${escapeHtml(content).replace(/`/g, '\\`')}\`)" class="hover:text-black">Copy</button>
            <button onclick="this.closest('.flex').remove()" class="hover:text-black">Delete</button>
          </div>
        </div>
      `;

      msg.innerHTML = html;
      const anchor = document.getElementById('chat-anchor');
      anchor.before(msg);
      autoScroll();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    window.copyText = function(button, text) {
      navigator.clipboard.writeText(text).then(() => {
        const original = button.innerHTML;
        button.innerHTML = 'Copied!';
        setTimeout(() => button.innerHTML = original, 2000);
      });
    };

    window.toggleExplanation = function(button) {
      const explanation = button.nextElementSibling;
      explanation.classList.toggle('hidden');
      button.textContent = explanation.classList.contains('hidden') ? 'View Explanation' : 'Hide Explanation';
    };

    function saveHistory(role, content) {
      conversationHistory.push({ role, content });
      localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
    }

    function loadHistory() {
      const saved = localStorage.getItem('chatHistory');
      if (!saved) return;
      
      conversationHistory = JSON.parse(saved);
      if (conversationHistory.length > 0) {
        removePlaceholder();
        conversationHistory.forEach(msg => {
          if (msg.role === 'user') {
            displayUserMessage(msg.content);
          } else if (msg.role === 'assistant') {
            if (typeof msg.content === 'object') {
              displayAssistantMessage(msg.content.expert_prompt, msg.content.explanation);
            } else {
              displayAssistantMessage(msg.content);
            }
          }
        });
      }
    }

    clearChatBtn.addEventListener('click', () => {
      if (confirm('Clear all chat history?')) {
        conversationHistory = [];
        localStorage.removeItem('chatHistory');
        chatInner.innerHTML = `
          <div id="placeholder" class="flex flex-col items-center justify-center min-h-[400px] text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-white font-bold text-5xl mb-4">
              ?
            </div>
            <h2 class="text-2xl font-semibold text-gray-900 mb-2">Ready to Create Prompts</h2>
            <p class="text-gray-500 text-sm">Choose a mode and start crafting your AI prompt</p>
          </div>
          <div id="chat-anchor"></div>
        `;
      }
    });
  </script>
</body>
</html>